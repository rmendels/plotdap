<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>plotdap • plotdap</title>

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- sticky kit -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script>



<meta property="og:title" content="plotdap" />



<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-title-body">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">plotdap</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="articles/using_plotdap.html">Using plotdap</a>
    </li>
  </ul>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/ropensci/plotdap">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="contents col-md-9">
    <div class="page-header">
      <h1>plotdap</h1>
    </div>

<div id="plotdap" class="section level1">

<p><a href="https://travis-ci.org/ropensci/plotdap"><img src="https://travis-ci.org/ropensci/plotdap.svg?branch=master" alt="Build Status"></a></p>
<p>The R package <strong>plotdap</strong> makes it easy to visualize ‘tabledap’ and ‘griddap’ objects obtained via the <a href="https://github.com/ropensci/rerddap"><strong>rerddap</strong></a> package.</p>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<p><strong>plotdap</strong> isn’t (yet) on CRAN, but you can install the development version with:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1">devtools<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/devtools/topics/reexports">install_github</a></span>(<span class="st">'ropensci/plotdap'</span>)</a></code></pre></div>
</div>
<div id="getting-started-with-plotdap" class="section level2">
<h2 class="hasAnchor">
<a href="#getting-started-with-plotdap" class="anchor"></a>Getting started with <code><a href="reference/plotdap.html">plotdap()</a></code>
</h2>
<p>The <code><a href="reference/plotdap.html">plotdap()</a></code> function makes it easy to visualize data acquired via <code>tabledap()</code> or <code>griddap()</code>. Regardless of the data you want to visualize, you’ll always want to start a plot via <code><a href="reference/plotdap.html">plotdap()</a></code>, where you may specify some “global” plotting options. Subsequent sections will demonstrate how to add tables/grids via <code><a href="reference/add_tabledap.html">add_tabledap()</a></code>/<code><a href="reference/add_griddap.html">add_griddap()</a></code>, but for now we’ll focus on options provided by <code><a href="reference/plotdap.html">plotdap()</a></code>. Most importantly, the first argument decides whether <a href="https://stat.ethz.ch/R-manual/R-devel/library/graphics/html/plot.html">base</a> or <a href="https://cran.r-project.org/package=ggplot2">ggplot2</a> graphics should be used for the actual plotting.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(plotdap)</a>
<a class="sourceLine" id="cb2-2" title="2"><span class="kw"><a href="reference/plotdap.html">plotdap</a></span>()</a>
<a class="sourceLine" id="cb2-3" title="3"><span class="kw"><a href="reference/plotdap.html">plotdap</a></span>(<span class="st">"base"</span>)</a></code></pre></div>
<p><img src="README_files/figure-html/world-1.png"><img src="README_files/figure-html/world-2.png"></p>
<p>In addition to choosing a plotting method, <code><a href="reference/plotdap.html">plotdap()</a></code> is where you can define properties of the background map, including the target projection using a valid coordinate reference system (CRS) defintion. Projection is performed using the <a href="http://proj4.org/">PROJ.4 library</a>, and <a href="http://www.spatialreference.org">spatialreference.org</a> is a great resource for finding PROJ.4 CRS descriptions. Using the search utility, you can for example, <a href="http://spatialreference.org/ref/sr-org/?search=South+Pole&amp;srtext=Search">search for “South Pole”</a> and pick from a number of options. Here I’ve chosen the <a href="http://spatialreference.org/ref/sr-org/8375/">MODIS South Pole Stereographic</a> option and copy-pasted the <a href="http://spatialreference.org/ref/sr-org/8375/proj4/">Proj4 page</a> with the CRS definition:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1"><span class="kw"><a href="reference/plotdap.html">plotdap</a></span>(<span class="st">"base"</span>,</a>
<a class="sourceLine" id="cb3-2" title="2">  <span class="dt">mapTitle =</span> <span class="st">"MODIS South Pole Stereographic"</span>, </a>
<a class="sourceLine" id="cb3-3" title="3">  <span class="dt">mapFill =</span> <span class="st">"transparent"</span>, </a>
<a class="sourceLine" id="cb3-4" title="4">  <span class="dt">mapColor =</span> <span class="st">"steelblue"</span>,</a>
<a class="sourceLine" id="cb3-5" title="5">  <span class="dt">crs =</span> <span class="st">"+proj=stere +lat_0=-90 +lat_ts=-90 +lon_0=-63 +k=1 +x_0=0 +y_0=0 +ellps=WGS84 +datum=WGS84 +units=m +no_defs"</span></a>
<a class="sourceLine" id="cb3-6" title="6">)</a></code></pre></div>
<p><img src="README_files/figure-html/southPole-1.png" style="display: block; margin: auto;"></p>
<p>You might notice that some projections aren’t “well-defined” on a global scale, and thus, may result in an error, or a “broken” looking map. For instance, <a href="http://spatialreference.org/ref/epsg/3467/">this Albers projection centered on Alaska</a>:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1">alaska &lt;-<span class="st"> "+proj=aea +lat_1=55 +lat_2=65 +lat_0=50 +lon_0=-154 +x_0=0 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs"</span></a>
<a class="sourceLine" id="cb4-2" title="2"><span class="kw"><a href="reference/plotdap.html">plotdap</a></span>(<span class="st">"base"</span>, <span class="dt">crs =</span> alaska)</a></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1"><span class="co">#&gt; Error code: 6</span></a>
<a class="sourceLine" id="cb5-2" title="2"><span class="co">#&gt; Error in CPL_transform(x, crs$proj4string, crs$epsg) : OGR error</span></a></code></pre></div>
<p>That does not mean we can’t use this (or similar) projections – we just have to be careful that they are sensible given the lat/lon limits. By default, those limits span the entire world, but as we’ll see later, the limits are shrunk to the given data (i.e., <code>griddap()</code> / <code>tabledap()</code>) limits. In other words, we should expect this projection to work once we “add” some data located near Alaska to the visualization. However, in case you want to make a map without any data, or want to customize the background map in some special way, you can supply an <a href="https://CRAN.R-project.org/package=sf"><strong>sf</strong></a> object (or something coercable to an <strong>sf</strong> object) to the <code>mapData</code> argument.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(sf)</a>
<a class="sourceLine" id="cb6-2" title="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(mapdata)</a>
<a class="sourceLine" id="cb6-3" title="3">w &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/st_as_sf">st_as_sf</a></span>(maps<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/maps/topics/map">map</a></span>(<span class="st">"world"</span>, <span class="dt">plot =</span> <span class="ot">FALSE</span>, <span class="dt">fill =</span> <span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb6-4" title="4">us &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/st_transform">st_transform</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/subset">subset</a></span>(w, ID <span class="op">==</span><span class="st"> "USA"</span>), alaska)</a>
<a class="sourceLine" id="cb6-5" title="5"><span class="kw"><a href="reference/plotdap.html">plotdap</a></span>(<span class="dt">mapData =</span> us)</a></code></pre></div>
<p><img src="README_files/figure-html/unnamed-chunk-2-1.png" style="display: block; margin: auto;"></p>
<p>With the odd exception of window sizing and projections, the options in <code><a href="reference/plotdap.html">plotdap()</a></code> should <em>just work</em> in a similar way for either plotting method. However, there are some useful options that are deliberately left out, since they work differently based on the plotting method.</p>
<p>Since the result of <code><a href="reference/plotdap.html">plotdap()</a></code> is always a map, it always forces a fixed aspect ratio (i.e., $\frac{height}{width}$ of graph equals $r=\frac{latitude}{longitude}$). For this reason, the current size of your graphics device may not be sensible for the value of $r$ (for instance, if $r$ is high, but the height of the graphics device is small, you may see an error such as: <code>polygon edge not found</code> since the device cannot possibly render the result under the conditions). For a number of reasons, <code><a href="reference/plotdap.html">plotdap()</a></code> will not automatically resize your graphics device; instead, it’s recommended that you use a reliable graphics device such as Cairo, and use a height/width ratio close to $r$.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1"><span class="co"># write plot to disk using the Cairo package</span></a>
<a class="sourceLine" id="cb7-2" title="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(Cairo)</a>
<a class="sourceLine" id="cb7-3" title="3"><span class="co"># (latitude limits) / (longitude limits)</span></a>
<a class="sourceLine" id="cb7-4" title="4">r &lt;-<span class="st"> </span><span class="dv">85</span> <span class="op">/</span><span class="st"> </span><span class="dv">120</span></a>
<a class="sourceLine" id="cb7-5" title="5"><span class="kw"><a href="https://www.rdocumentation.org/packages/Cairo/topics/Cairo">CairoPNG</a></span>(<span class="st">"myPlot.png"</span>, <span class="dt">height =</span> <span class="dv">400</span> <span class="op">*</span><span class="st"> </span>r, <span class="dt">width =</span> <span class="dv">400</span>, <span class="dt">res =</span> <span class="dv">96</span>)</a>
<a class="sourceLine" id="cb7-6" title="6"><span class="co"># alter default margins for base plotting (leaving just enough space for a title)</span></a>
<a class="sourceLine" id="cb7-7" title="7"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/par">par</a></span>(<span class="dt">mar =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>))</a>
<a class="sourceLine" id="cb7-8" title="8"><span class="kw"><a href="reference/plotdap.html">plotdap</a></span>(<span class="st">"base"</span>, <span class="dt">mapData =</span> us, <span class="dt">mapTitle =</span> <span class="st">"Albers projection of Alaska"</span>)</a>
<a class="sourceLine" id="cb7-9" title="9"><span class="kw"><a href="https://www.rdocumentation.org/packages/grDevices/topics/dev">dev.off</a></span>()</a>
<a class="sourceLine" id="cb7-10" title="10"><span class="co">#&gt; quartz_off_screen </span></a>
<a class="sourceLine" id="cb7-11" title="11"><span class="co">#&gt;                 2</span></a></code></pre></div>
<p><img src="README_files/figure-html/unnamed-chunk-3-1.png" style="display: block; margin: auto;"></p>
<p>More advanced users that know some base/ggplot2 plotting may want more control of certain aspects of the plot (a later section – Customizing <code><a href="reference/plotdap.html">plotdap()</a></code> objects – covers this topic).</p>
</div>
<div id="adding-tabledap-layers" class="section level2">
<h2 class="hasAnchor">
<a href="#adding-tabledap-layers" class="anchor"></a>Adding <code>tabledap()</code> layers</h2>
<p>The <code><a href="reference/add_tabledap.html">add_tabledap()</a></code> function allows you to add markers that encode variable(s) obtained via <code>tabledap()</code> to an existing <code><a href="reference/plotdap.html">plotdap()</a></code> object. For example, suppose we have the following <code>sardines</code> data, and wish to understand the frequency of subsample counts:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1">sardines &lt;-<span class="st"> </span><span class="kw">tabledap</span>(</a>
<a class="sourceLine" id="cb8-2" title="2">  <span class="st">'FRDCPSTrawlLHHaulCatch'</span>,</a>
<a class="sourceLine" id="cb8-3" title="3">  <span class="dt">fields =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'latitude'</span>,  <span class="st">'longitude'</span>, <span class="st">'time'</span>, <span class="st">'scientific_name'</span>, <span class="st">'subsample_count'</span>),</a>
<a class="sourceLine" id="cb8-4" title="4">  <span class="st">'time&gt;=2010-01-01'</span>, <span class="st">'time&lt;=2012-01-01'</span>, <span class="st">'scientific_name="Sardinops sagax"'</span></a>
<a class="sourceLine" id="cb8-5" title="5">)</a>
<a class="sourceLine" id="cb8-6" title="6">sardines</a>
<a class="sourceLine" id="cb8-7" title="7"><span class="co">#&gt; &lt;ERDDAP tabledap&gt; FRDCPSTrawlLHHaulCatch</span></a>
<a class="sourceLine" id="cb8-8" title="8"><span class="co">#&gt;    Path: [/Users/cpsievert/Library/Caches/R/rerddap/8cb244e059b86865b7933a3d9b72fe16.csv]</span></a>
<a class="sourceLine" id="cb8-9" title="9"><span class="co">#&gt;    Last updated: [2017-06-08 10:41:14]</span></a>
<a class="sourceLine" id="cb8-10" title="10"><span class="co">#&gt;    File size:    [0 mb]</span></a>
<a class="sourceLine" id="cb8-11" title="11"><span class="co">#&gt; # A tibble: 56 x 5</span></a>
<a class="sourceLine" id="cb8-12" title="12"><span class="co">#&gt;    latitude longitude                 time scientific_name subsample_count</span></a>
<a class="sourceLine" id="cb8-13" title="13"><span class="co">#&gt;  *    &lt;chr&gt;     &lt;chr&gt;                &lt;chr&gt;           &lt;chr&gt;           &lt;int&gt;</span></a>
<a class="sourceLine" id="cb8-14" title="14"><span class="co">#&gt;  1  38.1945   -124.07 2010-04-16T03:36:00Z Sardinops sagax              50</span></a>
<a class="sourceLine" id="cb8-15" title="15"><span class="co">#&gt;  2   37.609 -123.6561 2010-04-18T02:54:00Z Sardinops sagax              38</span></a>
<a class="sourceLine" id="cb8-16" title="16"><span class="co">#&gt;  3  37.4188 -123.3463 2010-04-18T10:48:00Z Sardinops sagax               1</span></a>
<a class="sourceLine" id="cb8-17" title="17"><span class="co">#&gt;  4   36.984 -123.3326 2010-04-19T03:27:00Z Sardinops sagax              50</span></a>
<a class="sourceLine" id="cb8-18" title="18"><span class="co">#&gt;  5  36.8118 -123.6868 2010-04-19T06:42:00Z Sardinops sagax              50</span></a>
<a class="sourceLine" id="cb8-19" title="19"><span class="co">#&gt;  6  36.7333 -123.8675 2010-04-19T09:55:00Z Sardinops sagax              50</span></a>
<a class="sourceLine" id="cb8-20" title="20"><span class="co">#&gt;  7   35.922 -124.7985 2010-04-20T07:21:00Z Sardinops sagax              39</span></a>
<a class="sourceLine" id="cb8-21" title="21"><span class="co">#&gt;  8   36.992 -123.7716 2010-04-27T02:56:00Z Sardinops sagax               2</span></a>
<a class="sourceLine" id="cb8-22" title="22"><span class="co">#&gt;  9  36.9725 -124.1091 2010-04-27T07:02:00Z Sardinops sagax               9</span></a>
<a class="sourceLine" id="cb8-23" title="23"><span class="co">#&gt; 10  36.9925 -124.3968 2010-04-27T10:04:00Z Sardinops sagax              50</span></a>
<a class="sourceLine" id="cb8-24" title="24"><span class="co">#&gt; # ... with 46 more rows</span></a></code></pre></div>
<p>At the very least, <code><a href="reference/add_tabledap.html">add_tabledap()</a></code> needs a base map (i.e., a <code><a href="reference/plotdap.html">plotdap()</a></code> object), the <code>tabledap()</code> data, and a <em>formula</em> defining the variable of interest (for encoding the color of the markers). In R, you can create a formula by prefixing <code>~</code> to some expression. This formula can simply reference a variable already residing in the dataset (e.g., <code>~subsample_count</code>) or it can be a function of some variables (e.g. <code>~log2(subsample_count)</code>):</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1"><span class="kw"><a href="reference/add_tabledap.html">add_tabledap</a></span>(</a>
<a class="sourceLine" id="cb9-2" title="2">  <span class="kw"><a href="reference/plotdap.html">plotdap</a></span>(), </a>
<a class="sourceLine" id="cb9-3" title="3">  sardines, </a>
<a class="sourceLine" id="cb9-4" title="4">  <span class="op">~</span>subsample_count</a>
<a class="sourceLine" id="cb9-5" title="5">)</a>
<a class="sourceLine" id="cb9-6" title="6"><span class="kw"><a href="reference/add_tabledap.html">add_tabledap</a></span>(</a>
<a class="sourceLine" id="cb9-7" title="7">  <span class="kw"><a href="reference/plotdap.html">plotdap</a></span>(<span class="dt">crs =</span> <span class="st">"+proj=robin"</span>, <span class="dt">mapTitle =</span> <span class="st">"Log subsample count"</span>), </a>
<a class="sourceLine" id="cb9-8" title="8">  sardines, </a>
<a class="sourceLine" id="cb9-9" title="9">  <span class="op">~</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Log">log2</a></span>(subsample_count)</a>
<a class="sourceLine" id="cb9-10" title="10">)</a></code></pre></div>
<p><img src="README_files/figure-html/unnamed-chunk-5-1.png"><img src="README_files/figure-html/unnamed-chunk-5-2.png"></p>
<p>Since <code>time</code> is an important variable in many <code>tabledap()</code> objects, <code><a href="reference/add_tabledap.html">add_tabledap()</a></code> also has a <code>animate</code> argument which allows you to easily animate over the <code>time</code> variable. It is also easy to alter the color scale and symbol type via the <code>color</code> and <code>shape</code> arguments. For details about these arguments, please refer to the documentation on <code><a href="https://www.rdocumentation.org/packages/utils/topics/help">help(add_tabledap)</a></code></p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1"><span class="kw"><a href="reference/add_tabledap.html">add_tabledap</a></span>(</a>
<a class="sourceLine" id="cb10-2" title="2">  <span class="kw"><a href="reference/plotdap.html">plotdap</a></span>(<span class="dt">crs =</span> <span class="st">"+proj=robin"</span>), </a>
<a class="sourceLine" id="cb10-3" title="3">  sardines, </a>
<a class="sourceLine" id="cb10-4" title="4">  <span class="op">~</span>subsample_count, </a>
<a class="sourceLine" id="cb10-5" title="5">  <span class="dt">color =</span> <span class="st">"density"</span>, </a>
<a class="sourceLine" id="cb10-6" title="6">  <span class="dt">shape =</span> <span class="dv">4</span>, </a>
<a class="sourceLine" id="cb10-7" title="7">  <span class="dt">animate =</span> <span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb10-8" title="8">)</a></code></pre></div>
<div align="center">
  <a href="http://i.imgur.com/87KAnsS">
    <img src="http://i.imgur.com/87KAnsS.gif" height="500" width="700"></a>
</div>
</div>
<div id="adding-griddap-layers" class="section level2">
<h2 class="hasAnchor">
<a href="#adding-griddap-layers" class="anchor"></a>Adding <code>griddap()</code> layers</h2>
<p>Similar to <code><a href="reference/add_tabledap.html">add_tabledap()</a></code>, the <code><a href="reference/add_griddap.html">add_griddap()</a></code> function makes it easy to add rasters (i.e., rectangular tiles) to a <code><a href="reference/plotdap.html">plotdap()</a></code> object. To demonstrate, lets obtain some of the latest sea surface temperatures along the western coast of the US.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1">murSST &lt;-<span class="st"> </span><span class="kw">griddap</span>(</a>
<a class="sourceLine" id="cb11-2" title="2">  <span class="st">'jplMURSST41'</span>, <span class="dt">latitude =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">22</span>, <span class="dv">51</span>), <span class="dt">longitude =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="op">-</span><span class="dv">140</span>, <span class="dv">-105</span>),</a>
<a class="sourceLine" id="cb11-3" title="3">  <span class="dt">time =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'last'</span>, <span class="st">'last'</span>), <span class="dt">fields =</span> <span class="st">'analysed_sst'</span></a>
<a class="sourceLine" id="cb11-4" title="4">)</a>
<a class="sourceLine" id="cb11-5" title="5">murSST</a>
<a class="sourceLine" id="cb11-6" title="6"><span class="co">#&gt; &lt;ERDDAP griddap&gt; jplMURSST41</span></a>
<a class="sourceLine" id="cb11-7" title="7"><span class="co">#&gt;    Path: [/Users/cpsievert/Library/Caches/R/rerddap/5d5022a6daf4b9e7957e864f84600bbf.nc]</span></a>
<a class="sourceLine" id="cb11-8" title="8"><span class="co">#&gt;    Last updated: [2017-06-08 10:57:49]</span></a>
<a class="sourceLine" id="cb11-9" title="9"><span class="co">#&gt;    File size:    [81.28 mb]</span></a>
<a class="sourceLine" id="cb11-10" title="10"><span class="co">#&gt;    Dimensions (dims/vars):   [3 X 1]</span></a>
<a class="sourceLine" id="cb11-11" title="11"><span class="co">#&gt;    Dim names: time, latitude, longitude</span></a>
<a class="sourceLine" id="cb11-12" title="12"><span class="co">#&gt;    Variable names: Analysed Sea Surface Temperature</span></a>
<a class="sourceLine" id="cb11-13" title="13"><span class="co">#&gt;    data.frame (rows/columns):   [10156401 X 4]</span></a>
<a class="sourceLine" id="cb11-14" title="14"><span class="co">#&gt; # A tibble: 10,156,401 x 4</span></a>
<a class="sourceLine" id="cb11-15" title="15"><span class="co">#&gt;                    time   lat     lon analysed_sst</span></a>
<a class="sourceLine" id="cb11-16" title="16"><span class="co">#&gt;                   &lt;chr&gt; &lt;dbl&gt;   &lt;dbl&gt;        &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb11-17" title="17"><span class="co">#&gt;  1 2017-06-06T09:00:00Z    22 -140.00       23.667</span></a>
<a class="sourceLine" id="cb11-18" title="18"><span class="co">#&gt;  2 2017-06-06T09:00:00Z    22 -139.99       23.675</span></a>
<a class="sourceLine" id="cb11-19" title="19"><span class="co">#&gt;  3 2017-06-06T09:00:00Z    22 -139.98       23.676</span></a>
<a class="sourceLine" id="cb11-20" title="20"><span class="co">#&gt;  4 2017-06-06T09:00:00Z    22 -139.97       23.674</span></a>
<a class="sourceLine" id="cb11-21" title="21"><span class="co">#&gt;  5 2017-06-06T09:00:00Z    22 -139.96       23.670</span></a>
<a class="sourceLine" id="cb11-22" title="22"><span class="co">#&gt;  6 2017-06-06T09:00:00Z    22 -139.95       23.670</span></a>
<a class="sourceLine" id="cb11-23" title="23"><span class="co">#&gt;  7 2017-06-06T09:00:00Z    22 -139.94       23.677</span></a>
<a class="sourceLine" id="cb11-24" title="24"><span class="co">#&gt;  8 2017-06-06T09:00:00Z    22 -139.93       23.688</span></a>
<a class="sourceLine" id="cb11-25" title="25"><span class="co">#&gt;  9 2017-06-06T09:00:00Z    22 -139.92       23.701</span></a>
<a class="sourceLine" id="cb11-26" title="26"><span class="co">#&gt; 10 2017-06-06T09:00:00Z    22 -139.91       23.714</span></a>
<a class="sourceLine" id="cb11-27" title="27"><span class="co">#&gt; # ... with 10,156,391 more rows</span></a></code></pre></div>
<p>Again, similar to <code><a href="reference/add_tabledap.html">add_tabledap()</a></code>, <code><a href="reference/add_griddap.html">add_griddap()</a></code> needs a base map (i.e., a <code><a href="reference/plotdap.html">plotdap()</a></code> object), the <code>griddap()</code> data, and a <em>formula</em> defining the variable of interest (for encoding the fill of the rectangles). The <code><a href="reference/add_griddap.html">add_griddap()</a></code> function also has a <code>maxpixels</code> argument which sets a maximum threshold for the number of cells (i.e., pixels) to use before projection and plotting occurs. Compared to ggplot2, base plotting is much more efficient at rendering raster objects, so it might be worth increasing the threshold in that case:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1"><span class="co"># reduce the number of trailing digits in the legend</span></a>
<a class="sourceLine" id="cb12-2" title="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/options">options</a></span>(<span class="dt">digits =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb12-3" title="3"><span class="co"># remove plotting margins</span></a>
<a class="sourceLine" id="cb12-4" title="4"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/par">par</a></span>(<span class="dt">mar =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>))</a>
<a class="sourceLine" id="cb12-5" title="5"><span class="kw"><a href="reference/add_griddap.html">add_griddap</a></span>(</a>
<a class="sourceLine" id="cb12-6" title="6">  <span class="kw"><a href="reference/plotdap.html">plotdap</a></span>(<span class="st">"base"</span>, <span class="dt">crs =</span> <span class="st">"+proj=robin"</span>), </a>
<a class="sourceLine" id="cb12-7" title="7">  murSST, <span class="op">~</span>analysed_sst, <span class="dt">maxpixels =</span> <span class="dv">50000</span></a>
<a class="sourceLine" id="cb12-8" title="8">)</a></code></pre></div>
<p><img src="README_files/figure-html/unnamed-chunk-8-1.png" style="display: block; margin: auto;"></p>
<p>The <code>murSST</code> grid has a single time point (i.e., <code>length(unique(murSST$data$time)) == 1</code>), but what do we do when there are multiple time points? In addition to animating multiple grids (a la <code><a href="reference/add_tabledap.html">add_tabledap()</a></code>), you also have the option to summarize multiple grids into a single grid. To demonstrate, lets grab some wind speeds measured along the west coast of the US.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" title="1">wind &lt;-<span class="st"> </span><span class="kw">griddap</span>(</a>
<a class="sourceLine" id="cb13-2" title="2">  <span class="st">'erdQMwindmday'</span>, <span class="dt">time =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'2016-11-16'</span>, <span class="st">'2017-01-16'</span>),</a>
<a class="sourceLine" id="cb13-3" title="3">  <span class="dt">latitude =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">30</span>, <span class="dv">50</span>), <span class="dt">longitude =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">210</span>, <span class="dv">240</span>),</a>
<a class="sourceLine" id="cb13-4" title="4">  <span class="dt">fields =</span> <span class="st">'x_wind'</span></a>
<a class="sourceLine" id="cb13-5" title="5">)</a>
<a class="sourceLine" id="cb13-6" title="6"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/unique">unique</a></span>(wind<span class="op">$</span>data<span class="op">$</span>time)</a>
<a class="sourceLine" id="cb13-7" title="7"><span class="co">#&gt; [1] "2016-11-16T00:00:00Z" "2016-12-16T00:00:00Z" "2017-01-16T00:00:00Z"</span></a></code></pre></div>
<p>When faced with multiple time periods, and <code>animate = FALSE</code> (the default), the <code>time</code> argument is used to reduce multiple grids (i.e., raster bricks) to a single grid (i.e., a single raster layer). You can pass any R function to the <code>time</code> argument, but when <code>animate = FALSE</code>, you should take care to ensure the function returns a single value. The default uses the <code><a href="https://www.rdocumentation.org/packages/base/topics/mean">mean()</a></code> function so that each cell represents the average (in this case amongst three time points), but we could easily set this to <code><a href="https://www.rdocumentation.org/packages/stats/topics/cor">var()</a></code> to get the variance for each cell:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" title="1"><span class="co"># add space for a title</span></a>
<a class="sourceLine" id="cb14-2" title="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/par">par</a></span>(<span class="dt">mar =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>))</a>
<a class="sourceLine" id="cb14-3" title="3"><span class="kw"><a href="reference/add_griddap.html">add_griddap</a></span>(</a>
<a class="sourceLine" id="cb14-4" title="4">  <span class="kw"><a href="reference/plotdap.html">plotdap</a></span>(<span class="st">"base"</span>, <span class="dt">crs =</span> alaska, <span class="dt">mapTitle =</span> <span class="st">"Mean wind speed"</span>), </a>
<a class="sourceLine" id="cb14-5" title="5">  wind, <span class="op">~</span>x_wind</a>
<a class="sourceLine" id="cb14-6" title="6">)</a>
<a class="sourceLine" id="cb14-7" title="7"><span class="kw"><a href="reference/add_griddap.html">add_griddap</a></span>(</a>
<a class="sourceLine" id="cb14-8" title="8">  <span class="kw"><a href="reference/plotdap.html">plotdap</a></span>(<span class="st">"base"</span>, <span class="dt">crs =</span> alaska, <span class="dt">mapTitle =</span> <span class="st">"Variance of wind speed"</span>), </a>
<a class="sourceLine" id="cb14-9" title="9">  wind, <span class="op">~</span>x_wind, <span class="dt">time =</span> var</a>
<a class="sourceLine" id="cb14-10" title="10">)</a></code></pre></div>
<p><img src="README_files/figure-html/unnamed-chunk-10-1.png"><img src="README_files/figure-html/unnamed-chunk-10-2.png"></p>
<p>If you just want to animate the raw grid values over time (instead of computing summary statistic(s) for each cell), you can set <code>time</code> to the <code>identity</code> function, then set <code>animate = TRUE</code>:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" title="1"><span class="kw"><a href="reference/add_griddap.html">add_griddap</a></span>(</a>
<a class="sourceLine" id="cb15-2" title="2">  <span class="kw"><a href="reference/plotdap.html">plotdap</a></span>(<span class="dt">crs =</span> <span class="st">"+proj=robin"</span>), </a>
<a class="sourceLine" id="cb15-3" title="3">  wind, <span class="op">~</span>x_wind, </a>
<a class="sourceLine" id="cb15-4" title="4">  <span class="dt">time =</span> identity, </a>
<a class="sourceLine" id="cb15-5" title="5">  <span class="dt">animate =</span> <span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb15-6" title="6">)</a></code></pre></div>
<div align="center">
  <a href="http://i.imgur.com/aev0aZt">
    <img src="http://i.imgur.com/aev0aZt.gif" height="500" width="700"></a>
</div>
</div>
<div id="combining-tablesgrids" class="section level2">
<h2 class="hasAnchor">
<a href="#combining-tablesgrids" class="anchor"></a>Combining tables/grids</h2>
<p>The <code><a href="reference/plotdap.html">plotdap()</a></code> interface is designed so that you can plot both tables and grids at once (although I don’t recommend trying to plot more than one <code>griddap()</code> or <code>tabledap()</code> object at once). It’s also designed to work well with the <code>%&gt;%</code> operator from the <strong>magrittr</strong> package so that code can be expressed in a left-to-right (rather than inside-out) fashion:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" title="1"><span class="kw"><a href="reference/plotdap.html">plotdap</a></span>(<span class="st">"base"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb16-2" title="2"><span class="st">  </span><span class="kw"><a href="reference/add_griddap.html">add_griddap</a></span>(murSST, <span class="op">~</span>analysed_sst) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb16-3" title="3"><span class="st">  </span><span class="kw"><a href="reference/add_tabledap.html">add_tabledap</a></span>(sardines, <span class="op">~</span>subsample_count)</a></code></pre></div>
<p><img src="README_files/figure-html/unnamed-chunk-12-1.png" style="display: block; margin: auto;"></p>
</div>
<div id="modifying-ggplotdap-objects" class="section level2">
<h2 class="hasAnchor">
<a href="#modifying-ggplotdap-objects" class="anchor"></a>Modifying <code>ggplotdap</code> objects</h2>
<p>By this point, you might have noticed some subtle differences in the defaults of <code><a href="reference/plotdap.html">plotdap("ggplot2")</a></code> versus <code><a href="reference/plotdap.html">plotdap("base")</a></code>. The default base version is left intentially minimal as it is often much harder (or impossible) to modify/remove elements from a base graphic once it’s drawn. However, this is fairly easy using the <strong>ggplot2</strong> approach (assuming you know a bit of <strong>ggplot2</strong>), thanks to the <code><a href="reference/add_ggplot.html">add_ggplot()</a></code> function (think of it like the <code>+</code> operator in <strong>ggplot2</strong>).</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" title="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(ggplot2)</a>
<a class="sourceLine" id="cb17-2" title="2"><span class="kw"><a href="reference/plotdap.html">plotdap</a></span>(<span class="dt">crs =</span> <span class="st">"+proj=robin"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb17-3" title="3"><span class="st">  </span><span class="kw"><a href="reference/add_tabledap.html">add_tabledap</a></span>(sardines, <span class="op">~</span>subsample_count, <span class="dt">size =</span> <span class="dv">1</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb17-4" title="4"><span class="st">  </span><span class="kw"><a href="reference/add_ggplot.html">add_ggplot</a></span>(</a>
<a class="sourceLine" id="cb17-5" title="5">    <span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/labs">labs</a></span>(</a>
<a class="sourceLine" id="cb17-6" title="6">      <span class="dt">subtitle =</span> <span class="st">"Sardinops sagax samples"</span>,</a>
<a class="sourceLine" id="cb17-7" title="7">      <span class="dt">caption =</span> <span class="st">"Sardines are yummy"</span></a>
<a class="sourceLine" id="cb17-8" title="8">    ), </a>
<a class="sourceLine" id="cb17-9" title="9">    <span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/ggtheme">theme_minimal</a></span>(),</a>
<a class="sourceLine" id="cb17-10" title="10">    <span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/theme">theme</a></span>(<span class="dt">axis.ticks =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/element">element_blank</a></span>(), <span class="dt">axis.text =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/element">element_blank</a></span>())</a>
<a class="sourceLine" id="cb17-11" title="11">  )</a></code></pre></div>
<p><img src="README_files/figure-html/unnamed-chunk-13-1.png" style="display: block; margin: auto;"></p>
</div>
</div>

  </div>

</div>


      <footer>
      <div class="copyright">
  <p>Developed by Carson Sievert, Roy Mendelssohn.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.9000.</p>
</div>
      </footer>
   </div>

  

  </body>
</html>

